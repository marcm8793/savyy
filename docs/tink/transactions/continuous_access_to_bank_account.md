# Continuous access to a bank account

Learn how to get uninterrupted access to an end user's transaction data.

## Prerequisites

- Go to Set up your Tink Console account and follow the steps to create a Console account and a sandbox app.
- Make sure that continuous access is enabled for your app. To request to have continuous access enabled, go to Console > [your_app] > Transactions > Data access and select Send request. You'll receive a request response via email. Once your request is approved, you're able to use your app with continuous access.
- Make sure that you understand the difference between our data-access models. This article is for continuous access. For information on the differences, see Data-access models.
- Make sure that the following client scopes are enabled for your app: `authorization:read`, `authorization:grant`, `provider-consents:read`, `provider-consents:write`, `user:create`, `user:delete`, `accounts:read`, `transactions:read`, `balances:read`, `credentials:read`, `credentials:write`, and `credentials:refresh`.

> **Note:** In Console, go to [your_app] > App settings > API Client > All available client scopes. If this section doesn't list the scopes, contact Tink Support to have the scopes enabled for you.

## Introduction

This article is divided into different sections that must be followed from top to bottom.

The first section shows how to authorize your app and create a user. The second section is similar to the first, but is used to grant authorization. The third section shows how to build a Tink URL that the end user must use to authenticate with their bank, select an account, and give their consent to your user. The fourth and last section shows how to get a token to fetch user data.

### Video: How to get continuous access to a user's bank account

Before we get into how you set up continuous access, there are two things that you should know.

First, if you want to experiment with Transactions by using our API, try our Postman collection for Transactions.

Second, continuous access provides you with a continuous flow of end-user transaction data. This means we fetch data continuously for 90 days (which is the maximum consent time).

If you need data access only once and to automatically have the data deleted 24 hours later, see One-time access to a bank account.

## 1. Create a user in two steps

This section shows how to authorize your app and use a scope to create a user. Section 2, Generate a user authorization code and grant user access, shows how to authorize the user by using a different scope.

A user is created in two steps. First, you must authorize your app to get a client access token value. Then, use this value to create a user.

### 1.1 Authorize your app

Use the `user:create` scope to authorize your app and get a client access token. Use this value in your authorized app to create users. The users are tied to the `client_id` for your app.

The following example shows how to use your `client_id` and `client_secret` to fetch your client access token, which is required to create a user.

**Request example**
_Fetch your client access token_

```bash
curl -v -X POST https://api.tink.com/api/v1/oauth/token \
-d 'client_id={YOUR_CLIENT_ID}' \
-d 'client_secret={YOUR_CLIENT_SECRET}' \
-d 'grant_type=client_credentials' \
-d 'scope=user:create'
```

**Response example**

```json
{
  "access_token": "{YOUR_CLIENT_ACCESS_TOKEN}",
  "token_type": "bearer",
  "expires_in": 1800,
  "scope": "user:create"
}
```

> **Note:** Your client access token is the `access_token` value. It's valid for 30 minutes (1800 seconds). If 30 minutes pass before you've finished making your integration, run the request again to generate and use a new client access token (that's also valid for 30 minutes).

### 1.2 Create a user

Use the client access token value to create your first user. Banking consents and accounts can be attached to the user.

There are two ways to identify users. `user_id` is the value that's generated by Tink. To instead use your own ID to identify users, use `external_user_id`. `external_user_id` is an identifier you associate with this user, which is unique within your app. We suggest avoiding PII and recommend using a generated ID containing only a-z, 0-9 and -. When performing API requests, you can interchange `user_id` and `external_user_id` but not state both at the same time. Both `user_id` and `external_user_id` are optional.

In this example, we create a new user with `user_123_abc` as the `external_user_id`. The parameters `market` and `locale` are mandatory when creating the user. The values that you enter are used by default unless you enter other `market` and `locale` values in a Tink URL. Note that the user doesn't have any consents or accounts yet, which are added in the next step.

**Request example**
_Create a new user_

```bash
curl -v -X POST https://api.tink.com/api/v1/user/create \
-H 'Authorization: Bearer {YOUR_CLIENT_ACCESS_TOKEN}' \
-H 'Content-Type: application/json' \
-d '
    {
      "external_user_id": "user_123_abc",
      "market": "GB",
      "locale": "en_US"
    }
  '
```

**Response example**

```json
{
  "external_user_id": "user_123_abc",
  "user_id": "THE_CREATED_USER_ID"
}
```

## 2. Generate a user authorization code and grant user access

This section is similar to section 1. You must still authorize access by creating a new client access token, but the difference is that you must now only use the scope `authorization:grant`.

### 2.1 Generate the code

The request example generates a new authorization code specifically for your app.

**Request example**
_Generate an authorization code_

```bash
curl -v -X POST https://api.tink.com/api/v1/oauth/token \
-d 'client_id={YOUR_CLIENT_ID}' \
-d 'client_secret={YOUR_CLIENT_SECRET}' \
-d 'grant_type=client_credentials' \
-d 'scope=authorization:grant'
```

**Response example**

```json
{
  "access_token": "{YOUR_CLIENT_ACCESS_TOKEN}",
  "token_type": "bearer",
  "expires_in": 1800,
  "scope": "authorization:grant"
}
```

### 2.2 Grant user access

The end user must now connect their bank account to your newly created user. To do this, the end user must use a Tink URL, which must first be granted access to your user.

> **Note:** In the authorization grant request, you must enter `actor_client_id=df05e4b379934cd09963197cc855bfe9`. This value never changes and is used by Tink to identify apps. Once you declare the value, you allow Tink to act on your behalf. This value isn't the same as your `client_id`, so make sure not to mix them up.

In this example, user access is granted.

**Request example**
_Grant user access_

```bash
curl -v -X POST https://api.tink.com/api/v1/oauth/authorization-grant/delegate \
-H 'Authorization: Bearer {YOUR_CLIENT_ACCESS_TOKEN}' \
-d 'actor_client_id=df05e4b379934cd09963197cc855bfe9' \
-d 'user_id={USER_ID_OPTIONAL}' \
-d 'external_user_id={YOUR_OWN_ID_OPTIONAL}' \
-d 'id_hint=End user name/username' \
-d 'scope=authorization:read,authorization:grant,credentials:refresh,credentials:read,credentials:write,providers:read,user:read'
```

**Response example**

```json
{
  "code": "{USER_AUTHORIZATION_CODE}"
}
```

## 3. Build the URL

A Tink URL consists of different parameters and is used to allow users to authenticate with their bank and select an account from which to fetch transaction data. When your end user opens the URL, they start a flow where they ultimately give their consent to the user that you have created.

Let's define some parameters that you can append to your URL.

- `authorization_code={USER_AUTHORIZATION_CODE}` is used to identify a user in the Tink flow. This value was generated at the end of section 2.
- `client_id={YOUR_CLIENT_ID}` is the unique ID for your app, which is found in [your_app] > App settings > API client.
- `locale={LOCALE}` is the language to use for user-facing text.
- `market={MARKET_CODE}` is the country for which a user is allowed to connect accounts.
- `redirect_uri={REDIRECT_URI}` is a URI that the end user is redirected to after they have completed the Tink flow, together with response parameters.
- `state={STATE_CODE}` is optional and is returned to you when the end user returns to your `redirect_uri`. Use this parameter to track the end user after they've left your app and entered the Tink flow. This value is returned with the user once the flow is completed. The parameter also adds CSRF attack prevention. If state isn't used, rely on the `credentials_id` value that we return in the response and map it back to your user. The state parameter shouldn't contain any sensitive information, such as the `user_id`.

**Tink URL example**

```
https://link.tink.com/1.0/transactions/connect-accounts?client_id={YOUR_CLIENT_ID}&state={OPTIONAL_STATE_CODE_THAT_YOU_SPECIFIED}&redirect_uri=https://console.tink.com/callback&authorization_code={USER_AUTHORIZATION_CODE}&market=GB&locale=en_US
```

When your users access the URL, they'll see a list of demo banks. Once they choose a bank, they'll see a list of demo bank accounts to choose from. Find demo-user credentials in Console > Demo Bank. Select the username and password for a Demo Bank user that suits your use case.

_[transactions-flow-example]_

When the Tink flow is completed, the end user is redirected to the redirect URL.

**The redirect URL format**

```
{redirect_uri}?client_id={YOUR_CLIENT_ID}&credentials_id={credentials_id}&state={OPTIONAL_STATE_CODE_THAT_YOU_SPECIFIED}
```

If you don't include the state parameter in your Tink URL, it won't be included in the redirect URL. If you've included the parameter, you can use it to map back to the `user_id` or `external_user_id`.

**Example callback URL**

```
https://console.tink.com/callback?client_id=&df05e4b379934cd09963197cc855bfe8&credentials_id=e5331af8d98f4c58800960202b6ec50d&state={OPTIONAL_STATE_CODE_THAT_YOU_SPECIFIED}&redirect_uri=https://console.tink.com/callback
```

## 4. Fetch user data

When the end user has completed the bank authentication flow, follow these steps to fetch their data. The steps are the same for all future data access.

### 4.1 Generate a new access_token

If 30 minutes pass before you've finished making your integration, run the API call request that is described in section 2 to generate and use a new client access token (that is also valid for 30 minutes).

### 4.2 Get a user access token

Get a user access token (not to be confused with client access token). This is done in two parts: first, you must obtain an `authorization_code` that corresponds to either your `user_id` or `external_user_id`, and then you exchange the `authorization_code` for a user access token.

**Generate authorization code**

```bash
curl -X POST https://api.tink.com/api/v1/oauth/authorization-grant \
-H 'Authorization: Bearer {YOUR_CLIENT_ACCESS_TOKEN}' \
-d 'user_id={THE_TINK_USER_ID}' \
-d 'external_user_id={YOUR_OWN_USER_ID}' \
-d 'scope=accounts:read,balances:read,transactions:read,provider-consents:read'
```

The response includes an authorization code that can be used only once and then expires. If you need to regenerate a flow for this user, repeat the API request in this section to generate a new code.

```json
{
  "code": "YOUR_USER_AUTHORIZATION_CODE"
}
```

Once you've obtained the `authorization_code` you can exchange it for a user access token.

**Get a user access token**

```bash
curl -v -X POST https://api.tink.com/api/v1/oauth/token \
-d 'code={YOUR_USER_AUTHORIZATION_CODE}' \
-d 'client_id={YOUR_CLIENT_ID}' \
-d 'client_secret={YOUR_CLIENT_SECRET}' \
-d 'grant_type=authorization_code'
```

**Response example**

```json
{
  "access_token": "USER_ACCESS_TOKEN",
  "token_type": "bearer",
  "expires_in": 1800,
  "refresh_token": "REFRESH_TOKEN",
  "scope": "accounts:read,balances:read,transactions:read"
}
```

The response includes the user access token.

Now you're set to start using your user access token to fetch aggregated data. Select one of the related articles to list accounts and balances or transactions.
